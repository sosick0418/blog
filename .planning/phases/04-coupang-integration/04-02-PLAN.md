---
phase: 04-coupang-integration
plan: 02
type: execute
depends_on: ["04-01"]
files_modified: [src/_data/coupang/products.js, src/_data/products.json]
---

<objective>
Implement product data fetching and transformation pipeline for Coupang products.

Purpose: Create the data layer that pulls product information and transforms it to the frontmatter format expected by post templates.
Output: Working product data module that outputs structured product data for 11ty.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-coupang-integration/04-01-SUMMARY.md
@.planning/phases/04-coupang-integration/DISCOVERY.md
@src/_data/coupang/index.js
@src/_data/coupang/config.js

**Tech stack available:** 11ty, Node.js, Nunjucks
**Established patterns:**
- Data files in `src/_data/` consumed by 11ty
- Post frontmatter: product.name, product.price, product.rating, product.affiliateLink, product.image, category

**From 04-01:**
- Integration method documented in DISCOVERY.md
- Module structure established
- Affiliate link format known
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement product data module</name>
  <files>src/_data/coupang/products.js</files>
  <action>
Create product data module based on DISCOVERY.md findings:

**If Coupang API available:**
- Implement async function to fetch product data from API
- Handle authentication using config.js credentials
- Parse response and extract: productId, name, price, imageUrl, category
- Handle rate limits with appropriate delays
- Cache responses to avoid repeated API calls during builds

**If manual/feed approach:**
- Create function to read products from JSON data file
- Validate required fields are present
- Support both single product and batch operations

Module exports:
- `getProducts()` - returns array of raw product data
- `getProduct(productId)` - returns single product or null

Use proper error handling with try/catch.
Log meaningful errors for debugging.
Return empty array on failure (graceful degradation).
  </action>
  <verify>node -e "const p = require('./src/_data/coupang/products'); console.log(typeof p.getProducts)"</verify>
  <done>Product data module exports working functions, handles errors gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Create sample products data file</name>
  <files>src/_data/products.json</files>
  <action>
Create sample products data file with realistic Coupang products:

Include 3-5 sample products with:
- productId (Coupang product identifier format)
- name (Korean product name)
- price (number, in KRW)
- imageUrl (placeholder or Coupang CDN format)
- category (electronics, home, beauty, etc.)
- description (brief Korean description)

Example structure:
```json
{
  "products": [
    {
      "productId": "1234567890",
      "name": "삼성 갤럭시 버즈2 프로",
      "price": 159000,
      "imageUrl": "/images/products/buds2-pro.jpg",
      "category": "electronics",
      "description": "삼성 프리미엄 무선 이어폰"
    }
  ]
}
```

This serves as:
- Test data for development
- Schema reference for LLM content generation (Phase 5)
- Fallback if API integration is unavailable
  </action>
  <verify>node -e "const d = require('./src/_data/products.json'); console.log(d.products.length)"</verify>
  <done>Sample products file exists with 3+ realistic Korean products, valid JSON</done>
</task>

<task type="auto">
  <name>Task 3: Implement data transformation</name>
  <files>src/_data/coupang/index.js</files>
  <action>
Update index.js to implement transformProductData function:

Transform raw Coupang data to post frontmatter format:
- Input: raw product object from products.js or products.json
- Output: object matching post template schema

Transformation mapping:
- productId → used for affiliate link generation
- name → product.name
- price → product.price (keep as number)
- imageUrl → product.image
- category → category (for filtering)
- Generate affiliateLink using config settings

Add helper function:
- `createPostFrontmatter(product)` - returns complete frontmatter object ready for markdown generation

Export all functions for use in post generation script (Plan 04-03).
  </action>
  <verify>node -e "const c = require('./src/_data/coupang'); const r = c.transformProductData({productId:'123',name:'테스트',price:10000,imageUrl:'/img.jpg',category:'test'}); console.log(r.product.name)"</verify>
  <done>transformProductData returns object with product.name, product.price, product.image, product.affiliateLink, category</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `src/_data/coupang/products.js` exports getProducts and getProduct functions
- [ ] `src/_data/products.json` contains 3+ sample products
- [ ] transformProductData produces correct frontmatter structure
- [ ] All modules load without errors
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- Product data fetching works (from file or API)
- Sample products available for testing
- Data transformation produces post-compatible format
- Foundation ready for affiliate link generation
</success_criteria>

<output>
After completion, create `.planning/phases/04-coupang-integration/04-02-SUMMARY.md`
</output>
