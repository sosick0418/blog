---
phase: 05-llm-content-pipeline
plan: 03
type: execute
depends_on: ["05-02"]
files_modified: [scripts/generate-post.js]
---

<objective>
Integrate LLM content generation with post generation script.

Purpose: Replace placeholder content with actual AI-generated Korean product reviews.
Output: Updated generate-post.js that produces complete, publishable blog posts with LLM content.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-llm-content-pipeline/DISCOVERY.md
@.planning/phases/05-llm-content-pipeline/05-01-SUMMARY.md
@.planning/phases/05-llm-content-pipeline/05-02-SUMMARY.md
@scripts/generate-post.js

**Current state:**
- generate-post.js creates posts with placeholder content (<!-- LLM content placeholder -->)
- Phase 4 established frontmatter generation
- LLM module from 05-01/05-02 provides generateReview function

**Target:**
- Replace generateContentPlaceholder() with actual LLM generation
- Add --no-llm flag to preserve placeholder behavior for testing
- Handle API errors gracefully (fallback to placeholder)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate LLM generation into post script</name>
  <files>scripts/generate-post.js</files>
  <action>
Update generate-post.js to use LLM content generation:

1. Add imports at top:
```javascript
import { generateReview, isConfigured } from '../src/_data/llm/index.js';
```

2. Add new CLI option parsing:
- `--no-llm` flag: Skip LLM generation, use placeholder (for testing)
- Store in options.noLlm boolean

3. Update generateContentPlaceholder function:
- Rename to generateContent(product, options)
- If options.noLlm OR !isConfigured(): return existing placeholder content
- Otherwise: call generateReview(product) and return result
- Wrap in try/catch: on error, log warning and return placeholder

4. Update generatePostContent to use async:
- Make async function
- await generateContent(product, options)

5. Update writePostFile to handle async:
- Make async function
- await generatePostContent

6. Update main() loop:
- Use await for writePostFile calls

Add console logging:
- "[LLM] Generating content for: {productName}" when using LLM
- "[LLM] Skipped: API not configured" when falling back
- "[LLM] Error: {message}, using placeholder" on failure
  </action>
  <verify>node scripts/generate-post.js --help (should show --no-llm option)</verify>
  <done>generate-post.js integrates LLM, falls back gracefully, supports --no-llm flag</done>
</task>

<task type="auto">
  <name>Task 2: Test LLM integration end-to-end</name>
  <files>scripts/generate-post.js</files>
  <action>
Test the integration with various scenarios:

1. Test --no-llm flag (should always work):
```bash
node scripts/generate-post.js --product 999999 --name "테스트 제품" --price 50000 --no-llm --force
```
- Verify file created with placeholder content
- Delete test file after

2. Test without API key (should fallback):
```bash
unset GEMINI_API_KEY && node scripts/generate-post.js --product 888888 --name "API 없는 테스트" --price 30000 --force
```
- Should log "[LLM] Skipped: API not configured"
- Should create file with placeholder
- Delete test file after

3. Clean up test files:
```bash
rm -f src/posts/테스트-제품.md src/posts/api-없는-테스트.md
```

4. Verify build still works:
```bash
npm run build
```

If GEMINI_API_KEY is configured in environment, also test actual LLM generation.
  </action>
  <verify>npm run build succeeds, no test files left behind</verify>
  <done>All test scenarios pass, fallback works correctly, build succeeds</done>
</task>

<task type="auto">
  <name>Task 3: Update help text and documentation</name>
  <files>scripts/generate-post.js</files>
  <action>
Update showHelp() function to document new LLM behavior:

Add to Options section:
```
  --no-llm           Skip LLM content generation, use placeholder template
                     Useful for testing or when API is rate-limited
```

Add new section "LLM Content Generation":
```
LLM Content Generation:
  By default, the script generates product review content using Google Gemini AI.

  Requirements:
    - Set GEMINI_API_KEY environment variable
    - See .env.example for configuration

  Fallback behavior:
    - If GEMINI_API_KEY is not set, placeholder content is used
    - If API call fails, placeholder content is used with warning
    - Use --no-llm to explicitly skip LLM generation
```

Ensure --help output is clean and informative.
  </action>
  <verify>node scripts/generate-post.js --help (shows LLM documentation)</verify>
  <done>Help text documents LLM integration, --no-llm flag, and fallback behavior</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] generate-post.js imports from LLM module
- [ ] --no-llm flag works correctly
- [ ] Fallback to placeholder when API not configured
- [ ] Help text documents LLM features
- [ ] `npm run build` succeeds
- [ ] No test files left in src/posts/
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Post generation produces LLM content when configured
- Graceful fallback maintains functionality without API key
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-llm-content-pipeline/05-03-SUMMARY.md`
</output>
