---
phase: 06-n8n-workflow-setup
plan: 01
type: execute
depends_on: []
files_modified: [docker-compose.yml, .env.example, n8n/workflows/content-pipeline.json]
---

<objective>
Set up n8n self-hosted environment with Docker Compose and create the base workflow structure.

Purpose: Establish the automation infrastructure that will orchestrate the content generation pipeline.
Output: Working n8n instance accessible locally with a base workflow template ready for content integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Tech stack available:**
- 11ty static site generator (configured)
- Gemini LLM integration (src/_data/llm/)
- Post generation script (scripts/generate-post.js)
- Coupang affiliate integration (src/_data/coupang/)

**Prior decisions:**
- Self-hosted n8n (user constraint)
- Free tier only (no paid services)
- Fully automatic publishing (no manual review)

**Discovery findings:**
- n8n runs well in Docker with docker-compose
- Schedule Trigger node for cron-based automation
- Execute Command node can run shell scripts (needs N8N_NODES_INCLUDE or security config)
- Workflow JSON can be exported/imported for version control
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Docker Compose configuration for n8n</name>
  <files>docker-compose.yml, .env.example</files>
  <action>
Create docker-compose.yml in project root with:
- n8n service using `docker.n8n.io/n8nio/n8n:latest` image
- Volume mounts for n8n data persistence (`./n8n-data:/home/node/.n8n`)
- Volume mount for project files so Execute Command can access scripts (`./:/app`)
- Environment variables: N8N_BASIC_AUTH_ACTIVE, N8N_BASIC_AUTH_USER, N8N_BASIC_AUTH_PASSWORD, GENERIC_TIMEZONE
- Enable Execute Command node: N8N_NODES_INCLUDE=n8n-nodes-base.executeCommand
- Port mapping: 5678:5678
- Working directory set to /app

Update .env.example with n8n configuration section:
- N8N_BASIC_AUTH_USER (default: admin)
- N8N_BASIC_AUTH_PASSWORD (placeholder)
- N8N_ENCRYPTION_KEY (placeholder for credential encryption)
- GENERIC_TIMEZONE (default: Asia/Seoul)

Do NOT include actual secrets, only placeholders.
  </action>
  <verify>docker-compose config validates without errors</verify>
  <done>docker-compose.yml exists with n8n service, .env.example updated with n8n section</done>
</task>

<task type="auto">
  <name>Task 2: Create n8n workflows directory and base workflow JSON</name>
  <files>n8n/workflows/content-pipeline.json</files>
  <action>
Create n8n/workflows/ directory structure for version-controlled workflows.

Create content-pipeline.json with base workflow containing:
- Manual Trigger node (for testing)
- Schedule Trigger node (configured for daily at 9:00 AM KST, disabled initially)
- Placeholder Code node with comment "Content generation will be added in Plan 02"

The workflow should be importable into n8n via the UI or CLI.

Use standard n8n workflow JSON format with:
- "name": "Coupang Content Pipeline"
- "nodes": array with trigger nodes
- "connections": empty initially (will be connected in Plan 02)
- "active": false (workflow disabled until fully configured)
  </action>
  <verify>cat n8n/workflows/content-pipeline.json | jq . validates as JSON</verify>
  <done>n8n/workflows/content-pipeline.json exists with valid n8n workflow structure containing Schedule Trigger</done>
</task>

<task type="auto">
  <name>Task 3: Add npm scripts for n8n operations</name>
  <files>package.json</files>
  <action>
Add npm scripts to package.json for n8n operations:
- "n8n:start": "docker-compose up -d" (start n8n in background)
- "n8n:stop": "docker-compose down" (stop n8n)
- "n8n:logs": "docker-compose logs -f n8n" (follow n8n logs)

These scripts provide convenient shortcuts for managing the n8n instance.
  </action>
  <verify>npm run n8n:start --help shows docker-compose command (dry run check)</verify>
  <done>package.json contains n8n:start, n8n:stop, n8n:logs scripts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docker-compose.yml exists and `docker-compose config` validates
- [ ] .env.example contains N8N_* environment variables
- [ ] n8n/workflows/content-pipeline.json is valid JSON
- [ ] package.json has n8n:* scripts
- [ ] `npm run build` still succeeds (no regressions)
</verification>

<success_criteria>

- All tasks completed
- Docker Compose configuration ready for n8n deployment
- Base workflow template created and version-controlled
- npm scripts available for n8n management
</success_criteria>

<output>
After completion, create `.planning/phases/06-n8n-workflow-setup/06-01-SUMMARY.md`:

# Plan 06-01 Summary: n8n Environment Setup

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 06-02-PLAN.md (Content Pipeline Workflow)
</output>
