---
phase: 06-n8n-workflow-setup
plan: 03
type: execute
depends_on: ["06-02"]
files_modified: [scripts/orchestrate-content.js, n8n/workflows/content-pipeline.json, n8n/workflows/error-handler.json]
---

<objective>
Add error handling and monitoring capabilities to the content pipeline workflow.

Purpose: Ensure pipeline failures are captured, logged, and optionally notified for operational visibility.
Output: Robust workflow with error handling, retry logic, and execution logging.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-n8n-workflow-setup/06-02-SUMMARY.md
@scripts/orchestrate-content.js
@n8n/workflows/content-pipeline.json

**Tech stack available:**
- orchestrate-content.js with git integration
- n8n workflow with Execute Command node
- n8n error workflow feature (built-in)

**Prior decisions:**
- Fully automatic publishing (no manual intervention)
- Free tier only (no paid notification services)

**n8n error handling patterns:**
- Error Trigger node for workflow-level error handling
- IF node for conditional error branching
- Execution data logging via n8n's built-in executions view
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance orchestration script with structured error handling</name>
  <files>scripts/orchestrate-content.js</files>
  <action>
Update orchestrate-content.js to improve error handling:

1. Add try-catch blocks around each operation (post generation, git add, git commit, git push)
2. Return structured error JSON with specific error codes:
   - { "success": false, "error": "POST_GENERATION_FAILED", "message": "..." }
   - { "success": false, "error": "GIT_ADD_FAILED", "message": "..." }
   - { "success": false, "error": "GIT_COMMIT_FAILED", "message": "..." }
   - { "success": false, "error": "GIT_PUSH_FAILED", "message": "..." }
3. Add timestamp to output: { "success": true, "timestamp": "ISO8601", ... }
4. Add --verbose flag for detailed logging to stderr (not stdout, to keep JSON clean)

Ensure all output to stdout is valid JSON (for n8n parsing).
Errors and verbose logs go to stderr.
  </action>
  <verify>node scripts/orchestrate-content.js --help shows --verbose flag</verify>
  <done>orchestrate-content.js has structured error codes and --verbose flag</done>
</task>

<task type="auto">
  <name>Task 2: Create error handler workflow</name>
  <files>n8n/workflows/error-handler.json</files>
  <action>
Create error-handler.json with:

1. Error Trigger node (triggers when any workflow fails)
2. Set node to extract error information:
   - workflowName: {{ $json.workflow.name }}
   - errorMessage: {{ $json.execution.error.message }}
   - timestamp: {{ $now.toISO() }}
3. Code node to format error log entry:
   - Create JSON log entry with workflow, error, timestamp
   - Output as formatted string for logging
4. (Optional placeholder) HTTP Request node stub for future webhook notification
   - Disabled by default
   - URL placeholder: "https://your-webhook-url.com/notify"
   - Comment: "Enable this node and configure URL for error notifications"

Set workflow as error handler in n8n settings (manual step documented in summary).
  </action>
  <verify>cat n8n/workflows/error-handler.json | jq '.nodes[0].type' contains "errorTrigger"</verify>
  <done>error-handler.json exists with Error Trigger and logging nodes</done>
</task>

<task type="auto">
  <name>Task 3: Update main workflow with error branching and enable production mode</name>
  <files>n8n/workflows/content-pipeline.json</files>
  <action>
Update content-pipeline.json:

1. Update IF node conditions to check for specific error codes:
   - Route "POST_GENERATION_FAILED" to retry branch (optional)
   - Route "GIT_PUSH_FAILED" to error notification branch

2. Add NoOp (No Operation) node for success path placeholder
   - Comment: "Success - post generated and committed"

3. Add NoOp node for error path placeholder
   - Comment: "Error - check n8n executions for details"

4. Remove --skip-git flag from Execute Command (enable full pipeline)
   - Keep --dry-run initially for safety until Phase 8 E2E testing

5. Update Schedule Trigger to realistic schedule:
   - Interval: Daily at 9:00 AM (0 9 * * *)
   - Keep disabled (active: false) until Phase 8

Document that workflow activation should happen in Phase 8 after E2E testing.
  </action>
  <verify>cat n8n/workflows/content-pipeline.json | jq '.nodes[] | select(.type | contains("noOp"))' shows NoOp nodes</verify>
  <done>content-pipeline.json has error branching, NoOp placeholders, and --dry-run for safety</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] scripts/orchestrate-content.js has structured error codes
- [ ] --verbose flag works and logs to stderr
- [ ] n8n/workflows/error-handler.json exists with Error Trigger
- [ ] n8n/workflows/content-pipeline.json has error branching
- [ ] Execute Command uses --dry-run (safety for pre-E2E)
- [ ] `npm run build` still succeeds
</verification>

<success_criteria>

- All tasks completed
- Error handling provides clear, structured error information
- Error handler workflow ready for import
- Main workflow has proper error branching
- Phase 6 complete, ready for Phase 7 (GitHub Pages Deployment)
</success_criteria>

<output>
After completion, create `.planning/phases/06-n8n-workflow-setup/06-03-SUMMARY.md`:

# Plan 06-03 Summary: Error Handling and Monitoring

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 6 complete. Ready for Phase 7 (GitHub Pages Deployment).

**Activation note:** The content-pipeline workflow is configured with --dry-run and inactive.
Full activation (remove --dry-run, set active: true) should occur in Phase 8 after E2E testing.
</output>
