---
phase: 06-n8n-workflow-setup
plan: 02
type: execute
depends_on: ["06-01"]
files_modified: [scripts/orchestrate-content.js, n8n/workflows/content-pipeline.json]
---

<objective>
Create the content generation orchestration script and integrate it into the n8n workflow.

Purpose: Connect the existing post generation script to n8n automation with git commit/push capabilities.
Output: Complete n8n workflow that generates content and commits to git automatically.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-n8n-workflow-setup/06-01-SUMMARY.md
@scripts/generate-post.js

**Tech stack available:**
- generate-post.js with LLM integration and --no-llm fallback
- Coupang product data structure (productId, productName, productPrice, etc.)
- n8n Docker environment from Plan 06-01

**Prior decisions:**
- Graceful fallback to placeholder when LLM unavailable (05-03)
- Fully automatic publishing without manual review (PROJECT.md)

**Integration pattern:**
- n8n Execute Command node runs shell scripts inside container
- Scripts have access to /app (project root) via volume mount
- Git operations via shell commands (git add, commit, push)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create orchestration script with git integration</name>
  <files>scripts/orchestrate-content.js</files>
  <action>
Create orchestrate-content.js that:

1. Accepts product data via --product-json argument (JSON string) or --file argument (JSON file path)
2. Calls generate-post.js internally (spawn child process or import functions)
3. After post generation, runs git operations:
   - git add src/posts/*.md
   - git commit -m "content: auto-generated post for {productName}"
   - git push origin main (configurable branch via GIT_BRANCH env var, default: main)
4. Outputs JSON result to stdout for n8n to capture:
   - { "success": true, "file": "path/to/post.md", "commit": "abc123" }
   - { "success": false, "error": "error message" }

Use child_process.execSync for git commands with error handling.
Include --dry-run flag that skips git push (for testing).
Include --skip-git flag that skips all git operations (for local testing).

The script should be executable standalone:
  node scripts/orchestrate-content.js --product-json '{"productId":"123","productName":"Test"}'
  </action>
  <verify>node scripts/orchestrate-content.js --help shows usage</verify>
  <done>orchestrate-content.js exists with git integration, --dry-run and --skip-git flags work</done>
</task>

<task type="auto">
  <name>Task 2: Update n8n workflow with Execute Command integration</name>
  <files>n8n/workflows/content-pipeline.json</files>
  <action>
Update content-pipeline.json to add:

1. Set node - Define sample product data for testing:
   {
     "productId": "sample-001",
     "productName": "테스트 제품",
     "productPrice": 29900,
     "category": "general"
   }

2. Execute Command node:
   - Command: cd /app && node scripts/orchestrate-content.js --product-json '{{ JSON.stringify($json) }}' --skip-git
   - Note: --skip-git for initial setup, will be removed when ready for production

3. IF node to check result:
   - Condition: Check if output contains "success": true
   - True branch: Continue (placeholder for notification in Plan 03)
   - False branch: Error handling (placeholder for Plan 03)

Connect nodes: Schedule Trigger -> Set -> Execute Command -> IF

Keep workflow inactive (active: false) until Plan 03 completes error handling.
  </action>
  <verify>cat n8n/workflows/content-pipeline.json | jq '.nodes | length' returns 5 or more nodes</verify>
  <done>content-pipeline.json has Set, Execute Command, and IF nodes connected to triggers</done>
</task>

<task type="auto">
  <name>Task 3: Add orchestration script to npm scripts</name>
  <files>package.json</files>
  <action>
Add npm script to package.json:
- "orchestrate": "node scripts/orchestrate-content.js"

This allows running: npm run orchestrate -- --product-json '...'
  </action>
  <verify>grep "orchestrate" package.json shows the script</verify>
  <done>package.json contains "orchestrate" script</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] scripts/orchestrate-content.js exists and runs without error
- [ ] --help flag shows usage information
- [ ] --dry-run flag works (generates post but doesn't push)
- [ ] --skip-git flag works (generates post, no git operations)
- [ ] n8n/workflows/content-pipeline.json has Execute Command node
- [ ] `npm run build` still succeeds
</verification>

<success_criteria>

- All tasks completed
- Orchestration script can generate posts and commit to git
- n8n workflow JSON updated with full pipeline nodes
- Workflow is ready for error handling (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/06-n8n-workflow-setup/06-02-SUMMARY.md`:

# Plan 06-02 Summary: Content Pipeline Workflow

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 06-03-PLAN.md (Error Handling and Monitoring)
</output>
