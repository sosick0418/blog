---
phase: 02-seo-infrastructure
plan: 02
type: execute
depends_on: []
files_modified: [eleventy.config.js, src/robots.njk]
---

<objective>
Generate XML sitemap and robots.txt for search engine crawling.

Purpose: Enable search engines to efficiently discover and crawl all content. Sitemap provides URL list with priorities, robots.txt controls crawler behavior.
Output: Auto-generated sitemap.xml and robots.txt in build output.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@eleventy.config.js
@package.json

**Tech stack available:**
- 11ty v3.1.2 (ES modules)
- Nunjucks templating

**Constraining decisions:**
- Phase 01-01: Using ES modules (type: "module" in package.json)
- Phase 01-01: Output directory is _site/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create robots.txt template</name>
  <files>src/robots.njk</files>
  <action>
Create src/robots.njk that generates robots.txt:

```
---
permalink: /robots.txt
eleventyExcludeFromCollections: true
---
User-agent: *
Allow: /

Sitemap: {{ site.url }}/sitemap.xml
```

Key points:
- Set permalink to /robots.txt (no .html extension)
- eleventyExcludeFromCollections: true prevents it from appearing in collections
- Allow all crawlers (no Disallow rules for affiliate blog)
- Reference sitemap at site.url/sitemap.xml
- site.url comes from _data/site.json (may be empty until domain configured)
  </action>
  <verify>npm run build && cat _site/robots.txt</verify>
  <done>robots.txt generated at _site/robots.txt with User-agent, Allow, and Sitemap directives</done>
</task>

<task type="auto">
  <name>Task 2: Create sitemap.xml template</name>
  <files>src/sitemap.njk</files>
  <action>
Create src/sitemap.njk that generates sitemap.xml using 11ty collections:

```njk
---
permalink: /sitemap.xml
eleventyExcludeFromCollections: true
---
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
{%- for page in collections.all %}
{%- if not page.data.eleventyExcludeFromCollections %}
  <url>
    <loc>{{ site.url }}{{ page.url }}</loc>
    <lastmod>{{ page.date | dateToISO }}</lastmod>
  </url>
{%- endif %}
{%- endfor %}
</urlset>
```

Key points:
- Loops through collections.all (all 11ty pages)
- Excludes pages with eleventyExcludeFromCollections: true (sitemap itself, robots.txt)
- Uses site.url from _data/site.json for full URLs
- Needs dateToISO filter to format dates (add in next task)
  </action>
  <verify>npm run build && cat _site/sitemap.xml</verify>
  <done>sitemap.xml generated with proper XML structure and page URLs</done>
</task>

<task type="auto">
  <name>Task 3: Add dateToISO filter to eleventy.config.js</name>
  <files>eleventy.config.js</files>
  <action>
Add a Nunjucks filter to format dates as ISO 8601 for sitemap.

In eleventy.config.js, add inside the export default function:

```javascript
// Add dateToISO filter for sitemap
eleventyConfig.addFilter("dateToISO", (date) => {
  return new Date(date).toISOString().split('T')[0];
});
```

This converts dates to YYYY-MM-DD format required by sitemaps.

Place the filter addition before the return statement.
  </action>
  <verify>npm run build && grep "lastmod" _site/sitemap.xml | head -2</verify>
  <done>dateToISO filter works, sitemap shows formatted dates</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] _site/robots.txt exists with User-agent and Sitemap directives
- [ ] _site/sitemap.xml exists with valid XML structure
- [ ] sitemap.xml contains at least one <url> entry (for index page)
- [ ] sitemap.xml contains properly formatted <lastmod> dates
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- robots.txt generated with proper directives
- sitemap.xml generated with all pages
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/02-seo-infrastructure/02-02-SUMMARY.md`
</output>
