{
  "name": "Content API Pipeline v2 (Gemini AI)",
  "nodes": [
    {
      "parameters": {},
      "id": "trigger-manual",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * *"
            }
          ]
        }
      },
      "id": "trigger-schedule",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [240, 500],
      "disabled": true,
      "notes": "Daily at 9:00 AM. Enable when ready for production."
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "productId",
              "value": "sample-001"
            },
            {
              "name": "name",
              "value": "í…ŒìŠ¤íŠ¸ ì œí’ˆ"
            },
            {
              "name": "category",
              "value": "electronics"
            },
            {
              "name": "affiliateUrl",
              "value": "https://link.coupang.com/re/AFFSDP?lptag=TEST&pageKey=sample-001"
            },
            {
              "name": "imageUrl",
              "value": ""
            },
            {
              "name": "productFeatures",
              "value": "ë¸”ë£¨íˆ¬ìŠ¤ 5.0, ë…¸ì´ì¦ˆìº”ìŠ¬ë§, 20ì‹œê°„ ì¬ìƒ, IPX4 ë°©ìˆ˜"
            }
          ],
          "number": [
            {
              "name": "price",
              "value": 29900
            },
            {
              "name": "rating",
              "value": 4.5
            }
          ],
          "boolean": [
            {
              "name": "autoDeploy",
              "value": true
            },
            {
              "name": "dryRun",
              "value": false
            }
          ]
        }
      },
      "id": "set-product-data",
      "name": "Set Product Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [500, 400],
      "notes": "Configure product data here.\n\nRequired:\n- productId: Coupang product ID\n- name: Product name (Korean)\n- price: Price in KRW\n- category: electronics | home | beauty\n- affiliateUrl: Coupang affiliate link\n- productFeatures: Key features for AI review\n\nOptional:\n- imageUrl: Product image URL\n- rating: 1-5 (supports decimals like 4.5)"
    },
    {
      "parameters": {
        "jsCode": "// Build prompt for Gemini AI review generation\nconst input = $input.first().json;\n\nconst categoryMap = {\n  'electronics': 'ê°€ì „/ë””ì§€í„¸',\n  'home': 'ìƒí™œ/ê°€êµ¬',\n  'beauty': 'ë·°í‹°',\n  'fashion': 'íŒ¨ì…˜'\n};\n\nconst categoryName = categoryMap[input.category] || input.category;\n\nconst prompt = `ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ìµœê³ ì˜ ì œí’ˆ ë¦¬ë·°ì–´ì…ë‹ˆë‹¤. ë‹¤ìŒ ì œí’ˆì— ëŒ€í•´ ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ” ìƒì„¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n\n## ì œí’ˆ ì •ë³´\n- ì œí’ˆëª…: ${input.name}\n- ì¹´í…Œê³ ë¦¬: ${categoryName}\n- ê°€ê²©: ${input.price.toLocaleString()}ì›\n- ì£¼ìš” íŠ¹ì§•: ${input.productFeatures || 'ì •ë³´ ì—†ìŒ'}\n- í‰ì : ${input.rating}/5\n\n## ì‘ì„± ìš”êµ¬ì‚¬í•­\n\n1. **ì œí’ˆ ì†Œê°œ** (200ì ì´ìƒ)\n   - ì´ ì œí’ˆì´ ì–´ë–¤ ì œí’ˆì¸ì§€ ëª…í™•í•˜ê²Œ ì„¤ëª…\n   - íƒ€ê²Ÿ ê³ ê°ì¸µ ì–¸ê¸‰\n   - ì‹œì¥ì—ì„œì˜ í¬ì§€ì…˜\n\n2. **í•µì‹¬ íŠ¹ì§• ë¶„ì„** (ê° íŠ¹ì§•ë³„ 100ì ì´ìƒ)\n   - ì£¼ìš” ìŠ¤í™ê³¼ ê¸°ëŠ¥ì„ ìƒì„¸íˆ ì„¤ëª…\n   - ì‹¤ì œ ì‚¬ìš© ì‹œ ì²´ê°ë˜ëŠ” ì¥ì \n   - ê²½ìŸ ì œí’ˆ ëŒ€ë¹„ ì°¨ë³„ì \n\n3. **ì‹¤ì‚¬ìš© ë¦¬ë·°** (300ì ì´ìƒ)\n   - ì‹¤ì œ ì‚¬ìš©ì ê´€ì ì—ì„œì˜ ê²½í—˜\n   - ì¼ìƒì—ì„œ ì–´ë–»ê²Œ í™œìš©ë˜ëŠ”ì§€\n   - ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ ì \n\n4. **ì¥ë‹¨ì  ë¶„ì„**\n   - ì¥ì  3-5ê°œ (ê°ê° êµ¬ì²´ì ìœ¼ë¡œ)\n   - ë‹¨ì  1-2ê°œ (ì†”ì§í•˜ê²Œ)\n\n5. **ê°€ì„±ë¹„ ë¶„ì„** (100ì ì´ìƒ)\n   - ê°€ê²© ëŒ€ë¹„ ê°€ì¹˜ í‰ê°€\n   - ë¹„ìŠ·í•œ ê°€ê²©ëŒ€ ê²½ìŸ ì œí’ˆê³¼ ë¹„êµ\n\n6. **ì¶”ì²œ ëŒ€ìƒ** (100ì ì´ìƒ)\n   - ì´ ì œí’ˆì´ íŠ¹íˆ ì˜ ë§ëŠ” ì‚¬ëŒ\n   - êµ¬ë§¤ë¥¼ ê³ ë ¤í•´ì•¼ í•  ì‚¬ëŒ\n\n7. **ì´í‰** (150ì ì´ìƒ)\n   - ì¢…í•©ì ì¸ í‰ê°€\n   - êµ¬ë§¤ ê¶Œì¥ë„\n\n## ì¶œë ¥ í˜•ì‹\në§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ## ì œëª© í˜•íƒœë¡œ ì„¹ì…˜ì„ êµ¬ë¶„í•´ì£¼ì„¸ìš”.\nê´‘ê³  ê°™ì€ ê³¼ì¥ëœ í‘œí˜„ì€ í”¼í•˜ê³ , ì „ë¬¸ê°€ê°€ ì§ì ‘ í…ŒìŠ¤íŠ¸í•œ ê²ƒì²˜ëŸ¼ êµ¬ì²´ì ì´ê³  ì‹ ë¢°ê° ìˆê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.\n\n## ì¶”ê°€ ìš”ì²­\n- ìŠ¤í™ ì •ë³´ ë°°ì—´ (specs): [{label: string, value: string}] í˜•íƒœë¡œ 4-6ê°œ\n- ì¥ì  ë°°ì—´ (pros): 3-5ê°œ\n- ë‹¨ì  ë°°ì—´ (cons): 1-2ê°œ\n- í•œ ì¤„ ì„¤ëª… (description): 50ì ì´ë‚´\n\në‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:\n{\n  \"description\": \"í•œ ì¤„ ì œí’ˆ ì„¤ëª…\",\n  \"specs\": [{\"label\": \"ìŠ¤í™ëª…\", \"value\": \"ìŠ¤í™ê°’\"}, ...],\n  \"pros\": [\"ì¥ì 1\", \"ì¥ì 2\", ...],\n  \"cons\": [\"ë‹¨ì 1\", ...],\n  \"content\": \"## ì œí’ˆ ì†Œê°œ\\\\n...ì „ì²´ ë§ˆí¬ë‹¤ìš´ ë¦¬ë·° ë³¸ë¬¸...\"\n}`;\n\nreturn [{\n  json: {\n    ...input,\n    geminiPrompt: prompt\n  }\n}];"
      },
      "id": "build-prompt",
      "name": "Build AI Prompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [720, 400],
      "notes": "Builds a detailed prompt for Gemini AI to generate professional product review content."
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": {{ JSON.stringify($json.geminiPrompt) }}\n    }]\n  }],\n  \"generationConfig\": {\n    \"temperature\": 0.7,\n    \"topK\": 40,\n    \"topP\": 0.95,\n    \"maxOutputTokens\": 4096,\n    \"responseMimeType\": \"application/json\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "gemini-request",
      "name": "Gemini AI Generate",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [940, 400],
      "credentials": {
        "httpQueryAuth": {
          "id": "gemini-api-key",
          "name": "Gemini API Key"
        }
      },
      "notes": "Calls Gemini API to generate professional review content.\n\nCredential setup:\n1. Create HTTP Query Auth credential\n2. Name: 'key'\n3. Value: Your Gemini API key from Google AI Studio"
    },
    {
      "parameters": {
        "jsCode": "// Parse Gemini response and merge with product data\nconst input = $input.first().json;\nlet aiContent;\n\ntry {\n  // Extract text from Gemini response\n  const responseText = input.body?.candidates?.[0]?.content?.parts?.[0]?.text;\n  \n  if (!responseText) {\n    throw new Error('No response from Gemini');\n  }\n  \n  // Parse JSON from response\n  aiContent = JSON.parse(responseText);\n} catch (error) {\n  // Fallback content if AI fails\n  aiContent = {\n    description: `${input.name} - í’ˆì§ˆê³¼ ê°€ì„±ë¹„ë¥¼ ëª¨ë‘ ê°–ì¶˜ ì¶”ì²œ ì œí’ˆ`,\n    specs: [\n      { label: 'ì¹´í…Œê³ ë¦¬', value: input.category },\n      { label: 'ê°€ê²©', value: `${input.price.toLocaleString()}ì›` }\n    ],\n    pros: ['ë›°ì–´ë‚œ í’ˆì§ˆ', 'í•©ë¦¬ì ì¸ ê°€ê²©', 'ë¹ ë¥¸ ë°°ì†¡'],\n    cons: ['ì¸ê¸° ìƒí’ˆìœ¼ë¡œ í’ˆì ˆ ê°€ëŠ¥ì„±'],\n    content: `## ì œí’ˆ ì†Œê°œ\\n\\n${input.name}ì€(ëŠ”) ë§ì€ ì‚¬ìš©ìë“¤ì—ê²Œ ì‚¬ë‘ë°›ëŠ” ì œí’ˆì…ë‹ˆë‹¤.\\n\\n## ì´í‰\\n\\nì´ ì œí’ˆì„ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ê°•ë ¥íˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.`\n  };\n}\n\n// Build final product data for API\nconst productData = {\n  productId: input.productId,\n  name: input.name,\n  price: input.price,\n  imageUrl: input.imageUrl || '',\n  category: input.category,\n  affiliateUrl: input.affiliateUrl,\n  rating: input.rating || 4,\n  description: aiContent.description,\n  specs: aiContent.specs,\n  pros: aiContent.pros,\n  cons: aiContent.cons,\n  content: aiContent.content,\n  autoDeploy: input.autoDeploy,\n  dryRun: input.dryRun\n};\n\nreturn [{ json: productData }];"
      },
      "id": "parse-ai-response",
      "name": "Parse AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1160, 400],
      "notes": "Parses Gemini AI response and builds final product data with AI-generated content."
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://content-api:3001/api/products",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json) }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "http-create-product",
      "name": "Create Product via API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1380, 400],
      "notes": "Sends AI-generated product data to Content API.\n\nAPI will:\n1. Validate data\n2. Add to products.json\n3. Git commit and push (if autoDeploy=true)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-success",
              "leftValue": "={{ $json.body.success }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "if-success",
      "name": "Check Success",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [1600, 400]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json.body;\n\nreturn [{\n  json: {\n    status: 'success',\n    message: `âœ… AI ë¦¬ë·° ìƒì„± ì™„ë£Œ: ${response.product.name}`,\n    productId: response.product.productId,\n    productName: response.product.name,\n    category: response.product.category,\n    contentGenerated: true,\n    deployed: response.product.autoDeploy && !response.product.dryRun,\n    timestamp: new Date().toISOString(),\n    previewUrl: `https://bichonhenry.cloud/review/${encodeURIComponent(response.product.name.replace(/\\s+/g, '-'))}/`\n  }\n}];"
      },
      "id": "success-handler",
      "name": "Success Handler",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1820, 300]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nlet errorCode = 'API_ERROR';\nlet errorMessage = 'Unknown error';\n\ntry {\n  if (input.body && input.body.error) {\n    errorCode = input.body.error;\n    errorMessage = input.body.message || errorCode;\n  } else if (input.statusCode !== 200 && input.statusCode !== 201) {\n    errorCode = `HTTP_${input.statusCode}`;\n    errorMessage = `API returned status ${input.statusCode}`;\n  }\n} catch (e) {\n  errorMessage = 'Failed to parse API response';\n}\n\nreturn [{\n  json: {\n    status: 'error',\n    errorCode: errorCode,\n    message: `âŒ ${errorMessage}`,\n    statusCode: input.statusCode,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "error-handler",
      "name": "Error Handler",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1820, 500]
    },
    {
      "parameters": {},
      "id": "success-complete",
      "name": "Success Complete",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [2040, 300],
      "notes": "ğŸ‰ Success! AI-generated review deployed.\n\nThe product page with professional review content is now live at:\nhttps://bichonhenry.cloud/review/[product-name]/\n\nGitHub Actions will complete deployment in ~2 minutes."
    },
    {
      "parameters": {},
      "id": "error-logged",
      "name": "Error Logged",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [2040, 500],
      "notes": "âš ï¸ Error occurred. Check execution details.\n\nCommon issues:\n- GEMINI_ERROR: API key invalid or quota exceeded\n- VALIDATION_ERROR: Missing required fields\n- DUPLICATE_PRODUCT: Product ID already exists\n- GIT_PUSH_FAILED: Git authentication issue"
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Set Product Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Set Product Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Product Data": {
      "main": [
        [
          {
            "node": "Build AI Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build AI Prompt": {
      "main": [
        [
          {
            "node": "Gemini AI Generate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini AI Generate": {
      "main": [
        [
          {
            "node": "Parse AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Response": {
      "main": [
        [
          {
            "node": "Create Product via API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Product via API": {
      "main": [
        [
          {
            "node": "Check Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Success": {
      "main": [
        [
          {
            "node": "Success Handler",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Success Handler": {
      "main": [
        [
          {
            "node": "Success Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Handler": {
      "main": [
        [
          {
            "node": "Error Logged",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2",
  "meta": {
    "templateCredsSetupCompleted": false,
    "instanceId": "techblog-gemini-pipeline"
  },
  "tags": [
    {
      "name": "gemini-ai",
      "createdAt": "2026-01-16T00:00:00.000Z",
      "updatedAt": "2026-01-16T00:00:00.000Z"
    },
    {
      "name": "content-generation",
      "createdAt": "2026-01-16T00:00:00.000Z",
      "updatedAt": "2026-01-16T00:00:00.000Z"
    }
  ]
}
